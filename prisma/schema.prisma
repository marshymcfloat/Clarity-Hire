generator client {
  provider = "prisma-client"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  id_token          String?
  expires_at        Int?
  token_type        String?
  scope             String?
  session_state     String?
  User              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  // [Bolt] Performance: Index for cascading deletes
  @@index([userId])
}

model Application {
  id                String              @id @default(cuid())
  userId            String
  jobId             String
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  status            ApplicationStatus   @default(SUBMITTED)
  resumeId          String
  attachmentUrls    String[]            @default([])
  coverLetter       String?
  Job               Job                 @relation(fields: [jobId], references: [id])
  Resume            Resume              @relation(fields: [resumeId], references: [id])
  User              User                @relation(fields: [userId], references: [id])
  ApplicationAnswer ApplicationAnswer[]

  @@unique([userId, jobId])
}

model ApplicationAnswer {
  id            String      @id @default(cuid())
  answer        String[]
  applicationId String
  questionId    String
  Application   Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  Question      Question    @relation(fields: [questionId], references: [id], onDelete: Cascade)

  @@unique([applicationId, questionId])
}

model Company {
  id               String          @id @default(cuid())
  name             String
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
  coverImage       String?
  description      String
  image            String?
  location         String
  slug             String          @unique
  websiteUrl       String?
  ownerId          String          @unique
  plan             String          @default("free")
  stripeCustomerId String?         @unique
  companySize      CompanySize?
  User             User            @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  CompanyMember    CompanyMember[]
  Job              Job[]
  Question         Question[]
}

model CompanyMember {
  id        String   @id @default(cuid())
  userId    String
  companyId String
  role      TeamRole @default(MEMBER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  Company   Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, companyId])
  // [Bolt] Performance: Index for filtering by company and cascading deletes
  @@index([companyId])
}

model Job {
  id               String          @id @default(cuid())
  title            String
  companyId        String
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
  department       String
  experienceLevel  ExperienceLevel
  jobType          JobType
  location         String
  salaryMax        Int?
  salaryMin        Int?
  benefits         String[]
  qualifications   String[]
  responsibilities String[]
  skills           String[]
  workArrangement  WorkArrangement @default(ON_SITE)
  workSchedule     String?
  summary          String
  status           JobStatus       @default(DRAFT)
  Application      Application[]
  Company          Company         @relation(fields: [companyId], references: [id])
  QuestionOnJob    QuestionOnJob[]
  SavedJob         SavedJob[]
}
}

model Question {
  id                String              @id @default(cuid())
  question          String
  companyId         String
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  type              QuestionTypeEnum
  options           String[]
  ApplicationAnswer ApplicationAnswer[]
  Company           Company             @relation(fields: [companyId], references: [id])
  QuestionOnJob     QuestionOnJob[]

  // [Bolt] Performance: Index for filtering by company
  @@index([companyId])
}


model QuestionOnJob {
  jobId      String
  questionId String
  order      Int      @default(0)
  isRequired Boolean  @default(true)
  Job        Job      @relation(fields: [jobId], references: [id], onDelete: Cascade)
  Question   Question @relation(fields: [questionId], references: [id], onDelete: Cascade)

  @@id([jobId, questionId])
  // [Bolt] Performance: Index for cascading deletes
  @@index([questionId])
}

model Resume {
  id          String        @id @default(cuid())  
  name        String
  userId      String
  url         String
  createdAt   DateTime      @default(now())
  deletedAt   DateTime?     @updatedAt
  Application Application[]
  User        User          @relation(fields: [userId], references: [id])
}

model SavedJob {
  id        String   @id @default(cuid())
  userId    String
  jobId     String
  createdAt DateTime @default(now())
  Job       Job      @relation(fields: [jobId], references: [id], onDelete: Cascade)
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, jobId])
  // [Bolt] Performance: Index for cascading deletes
  @@index([jobId])
}

model User {
  id             String          @id @default(cuid())
  email          String          @unique
  name           String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  username       String?         @unique
  image          String?
  emailVerified  DateTime?
  hashedPassword String?
  Account        Account[]
  Application    Application[]
  Company        Company?
  CompanyMember  CompanyMember[]
  Resume         Resume[]
  SavedJob       SavedJob[]
}

enum ApplicationStatus {
  SUBMITTED
  IN_REVIEW
  INTERVIEWING
  OFFERED
  REJECTED
  WITHDRAWN
  HIRED
}

enum CompanySize {
  SIZE_1_10
  SIZE_11_50
  SIZE_51_200
  SIZE_201_1000
  SIZE_1000_PLUS
}

enum ExperienceLevel {
  INTERNSHIP
  ENTRY_LEVEL
  ASSOCIATE
  MID_LEVEL
  SENIOR
  STAFF
  PRINCIPAL
}

enum JobStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum JobType {
  FULL_TIME
  PART_TIME
  CONTRACT
  INTERNSHIP
}

enum QuestionTypeEnum {
  TEXT
  MULTIPLE_CHOICE
  NUMBER
  CHECKBOX
  TRUE_OR_FALSE
}

enum TeamRole {
  ADMIN
  RECRUITER
  HIRING_MANAGER
  MEMBER
}

enum WorkArrangement {
  ON_SITE
  HYBRID
  REMOTE
}
